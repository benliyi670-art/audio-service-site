<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业配音服务 - 低预算出好配音</title>
    <style>
        /* 原style部分不变，省略以节省空间 */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>星辉文化 🎙️ 专业配音服务</h1>
            <p>✨ 低预算出好配音 ✨ 优质老师 ✨ 多种音色 ✨</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" id="searchInput" placeholder="🔍 在此处搜索您想要的配音类型">
                    <button class="search-btn" id="searchBtn">🔍 搜索</button>
                </div>
            </div>
            <div class="category-filters">
                <button class="category-btn active" data-category="all">全部</button>
                <button class="category-btn" data-category="大咖男老师">大咖男老师</button>
                <button class="category-btn" data-category="大咖女老师">大咖女老师</button>
                <button class="category-btn" data-category="顶尖男老师">顶尖男老师</button>
                <button class="category-btn" data-category="顶尖女老师">顶尖女老师</button>
                <button class="category-btn" data-category="普通男老师">普通男老师</button>
                <button class="category-btn" data-category="普通女老师">普通女老师</button>
            </div>
        </div>

        <div class="content">
            <div class="teachers-grid" id="teachersGrid"></div>
            
            <div class="pagination" id="teachersPagination"></div>
            
            <div class="no-results" id="noResults" style="display: none;">
                <h2>😕 没有找到相关内容</h2>
                <p>请尝试其他搜索关键词或选择不同分类</p>
            </div>
        </div>
    </div>

    <div class="player-bar" id="playerBar">
        <div class="player-content">
            <div class="player-info">
                <div class="player-title" id="playerTitle">未播放</div>
                <div class="player-teacher" id="playerTeacher">-</div>
            </div>
            <div class="player-controls">
                <button class="control-btn" id="playPauseBtn">▶</button>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="time-display" id="timeDisplay">0:00 / 0:00</span>
            </div>
            <button class="close-btn" id="closePlayer">X</button>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        let teachersData = [];
        let currentCategory = 'all';
        let currentSearchTerm = '';
        let currentTeacherPage = 1;
        let currentAudioPages = {};

        const isMobile = window.innerWidth <= 768;
        const teachersPerPage = isMobile ? 5 : 10;
        const audioPerPage = isMobile ? 3 : 5;
        const maxRandomAudios = 5;  // 随机展示的最大音频数

        const audioPlayer = document.getElementById('audioPlayer');
        const playerBar = document.getElementById('playerBar');
        const playerTitle = document.getElementById('playerTitle');
        const playerTeacher = document.getElementById('playerTeacher');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const timeDisplay = document.getElementById('timeDisplay');

        let currentAudio = null;

        async function init() {
            loadData();  // 改为同步加载硬编码数据
            renderTeachers();
            setupEventListeners();
            setupPlayer();
        }

        function loadData() {
            // 硬编码示例数据（替换为您的audios.json内容）
            const json = {
                "categories": {
                    "大咖男老师": {
                        "teachers": [
                            {
                                "id": "M001",
                                "name": "张老师",
                                "description": "专业促销配音",
                                "audios": [
                                    {"title": "促销活动1", "url": "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", "duration": "N/A"},
                                    {"title": "促销优惠2", "url": "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", "duration": "N/A"}
                                ]
                            },
                            // 添加更多老师...
                        ]
                    },
                    // 添加其他分类...
                }
            };

            teachersData = [];
            for (const catName in json.categories) {
                const cat = json.categories[catName];
                cat.teachers.forEach(teacher => {
                    teacher.category = catName;
                    teacher.description = teacher.description || '';
                    teacher.audios.forEach(audio => {
                        audio.url = audio.url.replace('http://', 'https://');
                        audio.duration = audio.duration || 'N/A';
                    });
                    teachersData.push(teacher);
                });
            }
        }

        // 其余JS代码不变（renderTeachers, renderAudios 等，从之前修改版本复制）
        function renderTeachers() {
            const grid = document.getElementById('teachersGrid');
            const noResults = document.getElementById('noResults');
            const pagination = document.getElementById('teachersPagination');
            
            let filteredTeachers = teachersData;

            if (currentCategory !== 'all') {
                filteredTeachers = filteredTeachers.filter(t => t.category === currentCategory);
            }

            if (currentSearchTerm) {
                // 搜索模式：收集所有匹配音频，随机选几个
                let allMatchingAudios = [];
                filteredTeachers.forEach(teacher => {
                    teacher.audios.forEach((audio, index) => {
                        if (audio.title.toLowerCase().includes(currentSearchTerm.toLowerCase())) {
                            allMatchingAudios.push({ teacher, audio, index });
                        }
                    });
                });

                if (allMatchingAudios.length === 0) {
                    grid.style.display = 'none';
                    noResults.style.display = 'block';
                    pagination.innerHTML = '';
                    return;
                }

                // 随机排序并选前maxRandomAudios个
                allMatchingAudios.sort(() => Math.random() - 0.5);
                allMatchingAudios = allMatchingAudios.slice(0, maxRandomAudios);

                grid.style.display = 'grid';
                noResults.style.display = 'none';
                pagination.innerHTML = '';  // 无分页

                grid.innerHTML = allMatchingAudios.map(({ teacher, audio, index }) => `
                    <div class="teacher-card">
                        <div class="teacher-header">
                            <div class="teacher-avatar">${teacher.id}</div>
                            <div class="teacher-info">
                                <h3>${teacher.name}</h3>
                                <span class="teacher-category">${teacher.category}</span>
                            </div>
                        </div>
                        <div class="teacher-desc">${teacher.description}</div>
                        <div class="audios-list">
                            <div class="audio-item">
                                <button class="play-btn" data-teacher-id="${teacher.id}" data-audio-index="${index}">▶</button>
                                <span class="audio-title">${audio.title}</span>
                                <span class="audio-duration">${audio.duration}</span>
                            </div>
                        </div>
                    </div>
                `).join('');

                grid.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const teacherId = e.target.dataset.teacherId;
                        const audioIndex = parseInt(e.target.dataset.audioIndex);
                        playAudio(teacherId, audioIndex);
                    });
                });
            } else {
                if (filteredTeachers.length === 0) {
                    grid.style.display = 'none';
                    noResults.style.display = 'block';
                    pagination.innerHTML = '';
                    return;
                }

                const totalPages = Math.ceil(filteredTeachers.length / teachersPerPage);
                const start = (currentTeacherPage - 1) * teachersPerPage;
                const end = start + teachersPerPage;
                const paginatedTeachers = filteredTeachers.slice(start, end);

                grid.style.display = 'grid';
                noResults.style.display = 'none';

                grid.innerHTML = paginatedTeachers.map(teacher => `
                    <div class="teacher-card">
                        <div class="teacher-header">
                            <div class="teacher-avatar">${teacher.id}</div>
                            <div class="teacher-info">
                                <h3>${teacher.name}</h3>
                                <span class="teacher-category">${teacher.category}</span>
                            </div>
                        </div>
                        <div class="teacher-desc">${teacher.description}</div>
                        <div class="audios-list" id="audios-${teacher.id}"></div>
                        <div class="audio-pagination" id="audio-pagination-${teacher.id}"></div>
                    </div>
                `).join('');

                paginatedTeachers.forEach(teacher => renderAudios(teacher));

                pagination.innerHTML = `
                    <button class="page-btn" ${currentTeacherPage === 1 ? 'disabled' : ''} onclick="changeTeacherPage(-1)">上一页</button>
                    <span>第 ${currentTeacherPage} / ${totalPages} 页</span>
                    <button class="page-btn" ${currentTeacherPage === totalPages ? 'disabled' : ''} onclick="changeTeacherPage(1)">下一页</button>
                `;
            }
        }

        // renderAudios, changeTeacherPage, changeAudioPage, playAudio, setupPlayer, formatTime, setupEventListeners 等函数不变，从之前版本复制即可

        window.changeTeacherPage = changeTeacherPage;
        window.changeAudioPage = changeAudioPage;
        init();
    </script>
</body>
</html>