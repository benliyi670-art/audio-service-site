<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“ä¸šé…éŸ³æœåŠ¡ - ä½é¢„ç®—å‡ºå¥½é…éŸ³</title>
    <style>
        /* åŸstyleéƒ¨åˆ†ä¸å˜ï¼Œçœç•¥ä»¥èŠ‚çœç©ºé—´ */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ˜Ÿè¾‰æ–‡åŒ– ğŸ™ï¸ ä¸“ä¸šé…éŸ³æœåŠ¡</h1>
            <p>âœ¨ ä½é¢„ç®—å‡ºå¥½é…éŸ³ âœ¨ ä¼˜è´¨è€å¸ˆ âœ¨ å¤šç§éŸ³è‰² âœ¨</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” åœ¨æ­¤å¤„æœç´¢æ‚¨æƒ³è¦çš„é…éŸ³ç±»å‹">
                    <button class="search-btn" id="searchBtn">ğŸ” æœç´¢</button>
                </div>
            </div>
            <div class="category-filters">
                <button class="category-btn active" data-category="all">å…¨éƒ¨</button>
                <button class="category-btn" data-category="å¤§å’–ç”·è€å¸ˆ">å¤§å’–ç”·è€å¸ˆ</button>
                <button class="category-btn" data-category="å¤§å’–å¥³è€å¸ˆ">å¤§å’–å¥³è€å¸ˆ</button>
                <button class="category-btn" data-category="é¡¶å°–ç”·è€å¸ˆ">é¡¶å°–ç”·è€å¸ˆ</button>
                <button class="category-btn" data-category="é¡¶å°–å¥³è€å¸ˆ">é¡¶å°–å¥³è€å¸ˆ</button>
                <button class="category-btn" data-category="æ™®é€šç”·è€å¸ˆ">æ™®é€šç”·è€å¸ˆ</button>
                <button class="category-btn" data-category="æ™®é€šå¥³è€å¸ˆ">æ™®é€šå¥³è€å¸ˆ</button>
            </div>
        </div>

        <div class="content">
            <div class="teachers-grid" id="teachersGrid"></div>
            
            <div class="pagination" id="teachersPagination"></div>
            
            <div class="no-results" id="noResults" style="display: none;">
                <h2>ğŸ˜• æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</h2>
                <p>è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯æˆ–é€‰æ‹©ä¸åŒåˆ†ç±»</p>
            </div>
        </div>
    </div>

    <div class="player-bar" id="playerBar">
        <div class="player-content">
            <div class="player-info">
                <div class="player-title" id="playerTitle">æœªæ’­æ”¾</div>
                <div class="player-teacher" id="playerTeacher">-</div>
            </div>
            <div class="player-controls">
                <button class="control-btn" id="playPauseBtn">â–¶</button>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="time-display" id="timeDisplay">0:00 / 0:00</span>
            </div>
            <button class="close-btn" id="closePlayer">X</button>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        let teachersData = [];
        let currentCategory = 'all';
        let currentSearchTerm = '';
        let currentTeacherPage = 1;
        let currentAudioPages = {};

        const isMobile = window.innerWidth <= 768;
        const teachersPerPage = isMobile ? 5 : 10;
        const audioPerPage = isMobile ? 3 : 5;
        const maxRandomAudios = 5;  // éšæœºå±•ç¤ºçš„æœ€å¤§éŸ³é¢‘æ•°

        const audioPlayer = document.getElementById('audioPlayer');
        const playerBar = document.getElementById('playerBar');
        const playerTitle = document.getElementById('playerTitle');
        const playerTeacher = document.getElementById('playerTeacher');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const timeDisplay = document.getElementById('timeDisplay');

        let currentAudio = null;

        async function init() {
            loadData();  // æ”¹ä¸ºåŒæ­¥åŠ è½½ç¡¬ç¼–ç æ•°æ®
            renderTeachers();
            setupEventListeners();
            setupPlayer();
        }

        function loadData() {
            // ç¡¬ç¼–ç ç¤ºä¾‹æ•°æ®ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„audios.jsonå†…å®¹ï¼‰
            const json = {
                "categories": {
                    "å¤§å’–ç”·è€å¸ˆ": {
                        "teachers": [
                            {
                                "id": "M001",
                                "name": "å¼ è€å¸ˆ",
                                "description": "ä¸“ä¸šä¿ƒé”€é…éŸ³",
                                "audios": [
                                    {"title": "ä¿ƒé”€æ´»åŠ¨1", "url": "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", "duration": "N/A"},
                                    {"title": "ä¿ƒé”€ä¼˜æƒ 2", "url": "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", "duration": "N/A"}
                                ]
                            },
                            // æ·»åŠ æ›´å¤šè€å¸ˆ...
                        ]
                    },
                    // æ·»åŠ å…¶ä»–åˆ†ç±»...
                }
            };

            teachersData = [];
            for (const catName in json.categories) {
                const cat = json.categories[catName];
                cat.teachers.forEach(teacher => {
                    teacher.category = catName;
                    teacher.description = teacher.description || '';
                    teacher.audios.forEach(audio => {
                        audio.url = audio.url.replace('http://', 'https://');
                        audio.duration = audio.duration || 'N/A';
                    });
                    teachersData.push(teacher);
                });
            }
        }

        // å…¶ä½™JSä»£ç ä¸å˜ï¼ˆrenderTeachers, renderAudios ç­‰ï¼Œä»ä¹‹å‰ä¿®æ”¹ç‰ˆæœ¬å¤åˆ¶ï¼‰
        function renderTeachers() {
            const grid = document.getElementById('teachersGrid');
            const noResults = document.getElementById('noResults');
            const pagination = document.getElementById('teachersPagination');
            
            let filteredTeachers = teachersData;

            if (currentCategory !== 'all') {
                filteredTeachers = filteredTeachers.filter(t => t.category === currentCategory);
            }

            if (currentSearchTerm) {
                // æœç´¢æ¨¡å¼ï¼šæ”¶é›†æ‰€æœ‰åŒ¹é…éŸ³é¢‘ï¼Œéšæœºé€‰å‡ ä¸ª
                let allMatchingAudios = [];
                filteredTeachers.forEach(teacher => {
                    teacher.audios.forEach((audio, index) => {
                        if (audio.title.toLowerCase().includes(currentSearchTerm.toLowerCase())) {
                            allMatchingAudios.push({ teacher, audio, index });
                        }
                    });
                });

                if (allMatchingAudios.length === 0) {
                    grid.style.display = 'none';
                    noResults.style.display = 'block';
                    pagination.innerHTML = '';
                    return;
                }

                // éšæœºæ’åºå¹¶é€‰å‰maxRandomAudiosä¸ª
                allMatchingAudios.sort(() => Math.random() - 0.5);
                allMatchingAudios = allMatchingAudios.slice(0, maxRandomAudios);

                grid.style.display = 'grid';
                noResults.style.display = 'none';
                pagination.innerHTML = '';  // æ— åˆ†é¡µ

                grid.innerHTML = allMatchingAudios.map(({ teacher, audio, index }) => `
                    <div class="teacher-card">
                        <div class="teacher-header">
                            <div class="teacher-avatar">${teacher.id}</div>
                            <div class="teacher-info">
                                <h3>${teacher.name}</h3>
                                <span class="teacher-category">${teacher.category}</span>
                            </div>
                        </div>
                        <div class="teacher-desc">${teacher.description}</div>
                        <div class="audios-list">
                            <div class="audio-item">
                                <button class="play-btn" data-teacher-id="${teacher.id}" data-audio-index="${index}">â–¶</button>
                                <span class="audio-title">${audio.title}</span>
                                <span class="audio-duration">${audio.duration}</span>
                            </div>
                        </div>
                    </div>
                `).join('');

                grid.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const teacherId = e.target.dataset.teacherId;
                        const audioIndex = parseInt(e.target.dataset.audioIndex);
                        playAudio(teacherId, audioIndex);
                    });
                });
            } else {
                if (filteredTeachers.length === 0) {
                    grid.style.display = 'none';
                    noResults.style.display = 'block';
                    pagination.innerHTML = '';
                    return;
                }

                const totalPages = Math.ceil(filteredTeachers.length / teachersPerPage);
                const start = (currentTeacherPage - 1) * teachersPerPage;
                const end = start + teachersPerPage;
                const paginatedTeachers = filteredTeachers.slice(start, end);

                grid.style.display = 'grid';
                noResults.style.display = 'none';

                grid.innerHTML = paginatedTeachers.map(teacher => `
                    <div class="teacher-card">
                        <div class="teacher-header">
                            <div class="teacher-avatar">${teacher.id}</div>
                            <div class="teacher-info">
                                <h3>${teacher.name}</h3>
                                <span class="teacher-category">${teacher.category}</span>
                            </div>
                        </div>
                        <div class="teacher-desc">${teacher.description}</div>
                        <div class="audios-list" id="audios-${teacher.id}"></div>
                        <div class="audio-pagination" id="audio-pagination-${teacher.id}"></div>
                    </div>
                `).join('');

                paginatedTeachers.forEach(teacher => renderAudios(teacher));

                pagination.innerHTML = `
                    <button class="page-btn" ${currentTeacherPage === 1 ? 'disabled' : ''} onclick="changeTeacherPage(-1)">ä¸Šä¸€é¡µ</button>
                    <span>ç¬¬ ${currentTeacherPage} / ${totalPages} é¡µ</span>
                    <button class="page-btn" ${currentTeacherPage === totalPages ? 'disabled' : ''} onclick="changeTeacherPage(1)">ä¸‹ä¸€é¡µ</button>
                `;
            }
        }

        // renderAudios, changeTeacherPage, changeAudioPage, playAudio, setupPlayer, formatTime, setupEventListeners ç­‰å‡½æ•°ä¸å˜ï¼Œä»ä¹‹å‰ç‰ˆæœ¬å¤åˆ¶å³å¯

        window.changeTeacherPage = changeTeacherPage;
        window.changeAudioPage = changeAudioPage;
        init();
    </script>
</body>
</html>